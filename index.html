<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OBS Overlay Configurator</title>
  <style>
    :root {
      --bg-color: #121212;
      --panel-bg: #1e1e1e;
      --text-color: #e0e0e0;
      --accent-color: #8BC34A;
      --border-color: #333;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      height: 100vh;
      display: flex;
      overflow: hidden;
    }

    /* å·¦ä¾§é…ç½®é¢æ¿ */
    .config-panel {
      width: 350px;
      background: var(--panel-bg);
      border-right: 1px solid var(--border-color);
      display: flex;
      flex-direction: column;
      height: 100%;
      box-shadow: 2px 0 10px rgba(0,0,0,0.3);
      z-index: 10;
    }

    .panel-header {
      padding: 20px;
      border-bottom: 1px solid var(--border-color);
      background: rgba(0,0,0,0.2);
    }

    .panel-header h1 {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
      color: var(--accent-color);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .panel-content {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .form-group label {
      font-size: 13px;
      font-weight: 500;
      color: #aaa;
    }

    .form-control {
      background: #2b2b2b;
      border: 1px solid #444;
      color: #fff;
      padding: 10px;
      border-radius: 4px;
      font-size: 14px;
      transition: border-color 0.2s;
    }

    .form-control:focus {
      outline: none;
      border-color: var(--accent-color);
    }

    textarea.form-control {
      resize: vertical;
      min-height: 60px;
    }

    /* å¼€å…³æ ·å¼ */
    .toggle-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 5px 0;
    }

    .toggle-label {
      font-size: 14px;
    }

    .switch {
      position: relative;
      display: inline-block;
      width: 44px;
      height: 24px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #444;
      transition: .3s;
      border-radius: 24px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .3s;
      border-radius: 50%;
    }

    input:checked + .slider {
      background-color: var(--accent-color);
    }

    input:checked + .slider:before {
      transform: translateX(20px);
    }

    /* é¢œè‰²é€‰æ‹©å™¨ */
    .color-picker-row {
      display: flex;
      gap: 10px;
    }
    
    .color-input-wrapper {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 10px;
      background: #2b2b2b;
      padding: 5px;
      border-radius: 4px;
      border: 1px solid #444;
    }

    input[type="color"] {
      width: 30px;
      height: 30px;
      border: none;
      background: none;
      padding: 0;
      cursor: pointer;
    }

    /* åº•éƒ¨æ“ä½œåŒº */
    .panel-footer {
      padding: 20px;
      border-top: 1px solid var(--border-color);
      background: rgba(0,0,0,0.2);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .btn {
      display: inline-flex;
      justify-content: center;
      align-items: center;
      padding: 12px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: background 0.2s;
      text-decoration: none;
    }

    .btn-primary {
      background: var(--accent-color);
      color: #121212;
    }

    .btn-primary:hover {
      background: #7cb342;
    }

    .btn-secondary {
      background: #444;
      color: #fff;
    }

    .btn-secondary:hover {
      background: #555;
    }

    .url-output {
      font-family: monospace;
      font-size: 12px;
      color: #888;
      word-break: break-all;
      margin-top: 5px;
      padding: 5px;
      background: #111;
      border-radius: 4px;
      max-height: 40px;
      overflow-y: auto;
    }

    /* å³ä¾§é¢„è§ˆ */
    .preview-area {
      flex: 1;
      background: #000;
      display: flex;
      flex-direction: column;
      position: relative;
      background-image: 
        linear-gradient(45deg, #111 25%, transparent 25%), 
        linear-gradient(-45deg, #111 25%, transparent 25%), 
        linear-gradient(45deg, transparent 75%, #111 75%), 
        linear-gradient(-45deg, transparent 75%, #111 75%);
      background-size: 20px 20px;
      background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
      overflow: hidden; /* é˜²æ­¢æº¢å‡º */
      align-items: center;
      justify-content: center;
    }

    .preview-container {
      width: 1920px;
      height: 1080px;
      transform-origin: center center;
      box-shadow: 0 0 50px rgba(0,0,0,0.5);
    }

    .preview-label {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0,0,0,0.7);
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 12px;
      pointer-events: none;
      z-index: 100;
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    /* å“åº”å¼è°ƒæ•´ */
    @media (max-width: 900px) {
      body { flex-direction: column; overflow: auto; }
      .config-panel { width: 100%; height: auto; border-right: none; border-bottom: 1px solid var(--border-color); }
      .preview-area { height: 500px; min-height: 50vh; }
    }
  </style>
</head>
<body>

  <!-- å·¦ä¾§æ§åˆ¶é¢æ¿ -->
  <aside class="config-panel">
    <div class="panel-header">
      <h1>âš™ï¸ Overlay Config</h1>
    </div>
    
    <div class="panel-content">
      <!-- æ–‡æœ¬é…ç½® -->
      <div class="form-group">
        <label>å…¬å‘Šå†…å®¹ / Announcement</label>
        <textarea id="input-announcement" class="form-control">æ²¡å•¥å¥½è¯´çš„ï¼Œéƒ½æ¥æˆ‘å®¶å–é…’å§ï¼</textarea>
      </div>

      <div class="form-group">
        <label>å…¬å‘Šé€Ÿåº¦ (ç§’) / Speed: <span id="speed-val">25</span>s</label>
        <input type="range" id="input-speed" class="form-control" min="5" max="60" value="25" step="1" style="height:auto;">
      </div>

      <div class="form-group">
        <label>æ¸¸æˆåç§° / Game Name</label>
        <input type="text" id="input-game" class="form-control" value="cities skylines 2">
      </div>

      <!-- å¼€å…³é…ç½® -->
      <div class="toggle-row">
        <span class="toggle-label">æ˜¾ç¤ºéŸ³ä¹æ¨¡å— (Music)</span>
        <label class="switch">
          <input type="checkbox" id="input-music">
          <span class="slider"></span>
        </label>
      </div>

      <div class="toggle-row">
        <span class="toggle-label">æ˜¾ç¤ºä¸ªäººä¸»é¡µ (Homepage)</span>
        <label class="switch">
          <input type="checkbox" id="input-homepage" checked>
          <span class="slider"></span>
        </label>
      </div>

      <div class="toggle-row">
        <span class="toggle-label">æ˜¾ç¤ºç‰ˆæƒä¿¡æ¯ (Copyright)</span>
        <label class="switch">
          <input type="checkbox" id="input-copyright" checked>
          <span class="slider"></span>
        </label>
      </div>

      <!-- é¢œè‰²é…ç½® -->
      <div class="form-group">
        <label>ä¸»é¢˜è‰²é…ç½®</label>
        <div class="color-picker-row">
          <div class="color-input-wrapper">
            <input type="color" id="input-color1" value="#8BC34A">
            <span>ä¸»è‰²</span>
          </div>
          <div class="color-input-wrapper">
            <input type="color" id="input-color2" value="#9C6ADE">
            <span>å‰¯è‰²</span>
          </div>
        </div>
      </div>
    </div>

    <div class="panel-footer">
      <button class="btn btn-primary" id="btn-copy">ğŸ“‹ å¤åˆ¶ OBS æµè§ˆå™¨æºé“¾æ¥</button>
      <a href="#" target="_blank" class="btn btn-secondary" id="btn-open">ğŸ”— åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€å®Œæ•´ç‰ˆ</a>
      <div class="url-output" id="url-preview">...</div>
    </div>
  </aside>

  <!-- å³ä¾§é¢„è§ˆ -->
  <main class="preview-area" id="preview-area">
    <div class="preview-label">Live Preview (1920x1080)</div>
    <div class="preview-container" id="preview-container">
      <iframe id="preview-frame" src="overlay.html" scrolling="no"></iframe>
    </div>
  </main>

  <script>
    // å®šä¹‰é…ç½®é¡¹ä¸DOMå…ƒç´ çš„æ˜ å°„
    const inputs = {
      announcement: document.getElementById('input-announcement'),
      speed: document.getElementById('input-speed'),
      game: document.getElementById('input-game'),
      music: document.getElementById('input-music'),
      homepage: document.getElementById('input-homepage'),
      copyright: document.getElementById('input-copyright'),
      color1: document.getElementById('input-color1'),
      color2: document.getElementById('input-color2')
    };

    const frame = document.getElementById('preview-frame');
    const container = document.getElementById('preview-container');
    const area = document.getElementById('preview-area');
    const urlPreview = document.getElementById('url-preview');
    const btnOpen = document.getElementById('btn-open');
    const btnCopy = document.getElementById('btn-copy');
    const speedVal = document.getElementById('speed-val');

    // è‡ªåŠ¨ç¼©æ”¾é¢„è§ˆ
    function resizePreview() {
      if (!container || !area) return;
      const targetW = 1920;
      const targetH = 1080;
      const availableW = area.clientWidth - 40; // padding
      const availableH = area.clientHeight - 40;

      const scale = Math.min(
        availableW / targetW, 
        availableH / targetH
      );

      container.style.transform = `scale(${scale})`;
      // ä¿æŒå±…ä¸­ä¸éœ€è¦é¢å¤–marginï¼Œå› ä¸ºflex center + transform-origin center
    }
    window.addEventListener('resize', resizePreview);
    // åˆå§‹è°ƒç”¨
    setTimeout(resizePreview, 100);

    // ç”ŸæˆQueryString
    function getQueryString() {
      const params = new URLSearchParams();
      
      params.set('announcement', inputs.announcement.value);
      params.set('speed', inputs.speed.value);
      params.set('game', inputs.game.value);
      
      // Checkboxå¤„ç†
      params.set('music', inputs.music.checked);
      params.set('homepage', inputs.homepage.checked);
      params.set('copyright', inputs.copyright.checked);

      // Colorå¤„ç†
      params.set('color1', inputs.color1.value);
      params.set('color2', inputs.color2.value);

      return params.toString();
    }

    // æ›´æ–°é€»è¾‘
    function update() {
      // Update UI labels
      speedVal.textContent = inputs.speed.value;

      const qs = getQueryString();
      const baseUrl = window.location.href.replace('index.html', 'overlay.html').split('?')[0]; 
      // æ³¨æ„ï¼šè¿™é‡Œå‡è®¾æœ€ç»ˆéƒ¨ç½²å config.html ä¼šå˜æˆ index.htmlï¼Œè€ŒåŸæ¥çš„ index.html å˜æˆ overlay.html
      // ä¸ºäº†æœ¬åœ°å¼€å‘ä¹Ÿèƒ½ç”¨ï¼Œæˆ‘ä»¬æ£€æµ‹æ–‡ä»¶å
      let targetFile = 'overlay.html';
      
      // æ„å»ºå®Œæ•´URLç”¨äºå¤åˆ¶
      // å¦‚æœå½“å‰æ˜¯æ ¹ç›®å½•æˆ– index.htmlï¼Œåˆ™ç›®æ ‡ä¹Ÿæ˜¯ç›¸å¯¹è·¯å¾„
      const cleanPath = window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/') + 1);
      const fullUrl = `${window.location.protocol}//${window.location.host}${cleanPath}${targetFile}?${qs}`;
      
      // æ›´æ–°é¢„è§ˆæ¡†
      frame.contentWindow.postMessage({
        type: 'updateConfig',
        queryString: qs
      }, '*');

      // æ›´æ–°åº•éƒ¨é“¾æ¥æ˜¾ç¤º
      urlPreview.textContent = fullUrl;
      btnOpen.href = fullUrl;
    }

    // ç»‘å®šäº‹ä»¶
    Object.values(inputs).forEach(input => {
      input.addEventListener('input', update);
      input.addEventListener('change', update); // check boxes
    });

    // å¤åˆ¶æŒ‰é’®
    btnCopy.addEventListener('click', () => {
      const url = btnOpen.href;
      navigator.clipboard.writeText(url).then(() => {
        const originalText = btnCopy.textContent;
        btnCopy.textContent = "âœ… å·²å¤åˆ¶ï¼";
        setTimeout(() => btnCopy.textContent = originalText, 2000);
      });
    });

    // åˆå§‹åŒ–æ‰§è¡Œä¸€æ¬¡
    // ç­‰å¾…ä¸€å°ä¼šç¡®ä¿ iframe åŠ è½½ (è™½ç„¶ postMessage æ— éœ€ loadï¼Œä½†é¢„è§ˆç¬¬ä¸€çœ¼è¿˜æ˜¯è¦çš„)
    // å®é™…ä¸Šæˆ‘ä»¬å¯ä»¥å…ˆè®© iframe åŠ è½½é»˜è®¤å‚æ•°ï¼Œæˆ–è€…é¡µé¢åŠ è½½åç«‹å³è§¦å‘ä¸€æ¬¡ update
    // ä½† iframe æœ¬èº« src="index.html" ä¼šè‡ªå·±è·‘ä¸€æ¬¡é»˜è®¤é€»è¾‘ã€‚
    // æˆ‘ä»¬åªéœ€åœ¨é¡µé¢åŠ è½½åæŠŠå½“å‰ input çš„å€¼æ¨è¿‡å»è¦†ç›–é»˜è®¤å³å¯ã€‚
    
    frame.onload = () => {
       update();
    };
    
    // å¦‚æœ onload å·²è¿‡ (æœ¬åœ°æµ‹è¯•å¿«çš„æ—¶å€™)ï¼Œä¹Ÿè°ƒç”¨ä¸€æ¬¡
    setTimeout(update, 500);

  </script>
</body>
</html>